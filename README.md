# RTM Deploy

RealTrainMod のアドオン制作を支援するコマンドラインツール

# 目標

## 機能

コマンドラインでアドオンのビルドやエラー検出、Minecraft の起動まで行う

## コマンド

-   `rtm-deploy init` プロジェクト初期化
-   `rtm-deploy validate` エラー検出
-   `rtm-deploy build` 不要なファイルを削除、minify を行い.zip として出力
-   `rtm-deploy run` ビルドしたアドオンを mods フォルダに配置し、Minecraft を起動
-   `rtm-deploy preview` アドオン構成図を出力

### 1. `init` - プロジェクト初期化

| 項目       | 内容                                                                                             |
| ---------- | ------------------------------------------------------------------------------------------------ |
| コマンド名 | `rtm-deploy init`                                                                                |
| 入力       | `--type`（例：vehicle, block, sign）                                                             |
| 処理内容   | - テンプレート構成を展開                                                                         |
| 出力       | 初期化済みアドオンディレクトリ                                                                   |
| 設定依存   | なし                                                                                             |
| エラー処理 | - 既存ファイルがある場合は警告を出し、上書き確認を促す<br>- サポートされないアドオンタイプは拒否 |

### 2. `validate` - アドオン検証

| 項目       | 内容                                                                                                                                                                 |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| コマンド名 | `rtm-deploy validate`                                                                                                                                                |
| 入力       | 対象アドオンフォルダ（カレント or `--target`）                                                                                                                       |
| 処理内容   | - JSON ファイルの構文チェック（JSON パース）<br>- 必須フィールドの存在確認<br>- 参照ファイルの実在確認<br>- MQO ファイルの整合性チェック（例：多角面、材質設定など） |
| 出力       | - CLI にエラー/警告を出力<br>- `validate.log`（オプション）に JSON 形式でログ保存可能                                                                                |
| 設定依存   | なし                                                                                                                                                                 |
| エラー処理 | - JSON 構文エラーは即終了<br>- 警告（不要ファイル、推奨構文違反など）は続行可                                                                                        |
| オプション | `--log`（ログファイル出力）、`--strict`（警告もエラー扱い）                                                                                                          |

### 3. `build` - アドオンのビルド

| 項目       | 内容                                                                                                                                                                |
| ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| コマンド名 | `rtm-deploy build`                                                                                                                                                  |
| 入力       | アドオンフォルダ（カレント or `--target`）                                                                                                                          |
| 処理内容   | - `validate` を内部で自動実行<br>- 不要ファイル（未参照モデル、余分な画像など）を除外<br>- 必要ファイルのみを抽出して ZIP 圧縮<br>- 出力先は `./dist/<addon名>.zip` |
| 出力       | ビルド済み ZIP ファイル                                                                                                                                             |
| 設定依存   | なし（出力パスは変更可能にする予定）                                                                                                                                |
| エラー処理 | `validate` で重大エラーがある場合はビルド中止                                                                                                                       |
| オプション | `--include-unused`（未使用ファイルを含める）                                                                                                                        |

### 4. `run` - ビルド＋デプロイ＋ Minecraft 起動

| 項目       | 内容                                                                                                                                                                                                             |
| ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| コマンド名 | `rtm-deploy run`                                                                                                                                                                                                 |
| 入力       | `--version`（MC バージョン名）、`--no-launch`、`--clean` など                                                                                                                                                    |
| 処理内容   | - `validate` → `build` を内部実行<br>- `.rtmdeployrc` を読み込み、mods フォルダを決定<br>- ZIP を mods フォルダにコピー（`--clean`で旧アドオン削除）<br>- `--no-launch` がない場合、Minecraft 起動コマンドを実行 |
| 出力       | - 配置ログ<br>- Minecraft の起動ログ（またはコマンド実行結果）                                                                                                                                                   |
| 設定依存   | `.rtmdeployrc` に `mc_versions`, `minecraft_launcher` が必要                                                                                                                                                     |
| エラー処理 | - バージョン未定義 → エラー<br>- `.rtmdeployrc` 未設定 → エラー                                                                                                                                                  |
| オプション | - `--clean`: mods フォルダから旧 ZIP 削除<br>- `--no-launch`: 起動をスキップ<br>- `--dry-run`: 配置のみ試行                                                                                                      |

### 5. `preview` - ファイル構成の可視化

| 項目       | 内容                                                                                                                |
| ---------- | ------------------------------------------------------------------------------------------------------------------- |
| コマンド名 | `rtm-deploy preview`                                                                                                |
| 入力       | アドオンディレクトリ（カレント or `--target`）                                                                      |
| 処理内容   | - `addon.json` の構成ツリーを解析<br>- モデル、テクスチャとの関連をマッピング<br>- CLI 表示または HTML レポート生成 |
| 出力       | CLI ツリー表示 or `preview.html`                                                                                    |
| 設定依存   | なし                                                                                                                |
| エラー処理 | 無効な JSON、ファイル不足などは警告として表示                                                                       |
| オプション | `--format html` / `--format cli`（既定）                                                                            |

## 設定ファイル

`.rtmdeployrc` 設定ファイル仕様

```json
{
    "mc_versions": [
        {
            "name": "KaizPatch",
            "dir": "path/to/mods/",
            "launcher_name": "1.7.10 - Kaiz"
        },
        {
            "name": "fixRTM",
            "dir": "path/to/mods/",
            "launcher_name": "1.12.2 - fixRTM"
        }
    ],
    "default_version": "KaizPatch",
    "minecraft_launcher": "C:/Program Files/Prism Launcher/PrismLauncher.exe"
}
```

| 項目                 | 説明                                                                 |
| -------------------- | -------------------------------------------------------------------- |
| `mc_versions`        | 対応するバージョンごとの mods フォルダパスとランチャーでの起動構成名 |
| `default_version`    | `--version` 指定がない場合のデフォルト                               |
| `minecraft_launcher` | Minecraft を起動する実行ファイルパス                                 |
